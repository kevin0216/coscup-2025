<script setup lang="ts">
import Banner from '#components/Banner.vue'
import mediumZoom from 'medium-zoom'
import { inBrowser, useData, useRoute } from 'vitepress'
import DefaultTheme from 'vitepress/theme'
import { nextTick, onMounted, watch, watchEffect } from 'vue'
import { Toaster } from 'vue-sonner'
import 'vue-sonner/style.css'

const { lang } = useData()

watchEffect(() => {
  if (inBrowser) {
    document.cookie = `lang=${lang.value};path=/`
  }
})

const route = useRoute()

function initZoom() {
  mediumZoom('.main img', { background: 'var(--vp-c-bg)' })
}

function updateNavBarMenuClass() {
  if (!inBrowser) return

  const params = new URLSearchParams(window.location.search)
  const nav = document.querySelector('.VPNav')
  if (!nav) return

  nav.classList.toggle('hidden', params.get('mode') === 'app')
}

onMounted(() => {
  initZoom()
  updateNavBarMenuClass()
})

watch(
  () => route.path,
  () => nextTick(() => {
    initZoom()
    updateNavBarMenuClass()
  }),
)
</script>

<template>
  <DefaultTheme.Layout>
    <template #home-hero-before>
      <Banner />
    </template>
    <template #layout-bottom>
      <Footer />
    </template>
  </DefaultTheme.Layout>
  <Toaster />
</template>
